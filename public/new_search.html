<!DOCTYPE html>
<html lang="en">

<head>
    <title>X</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/prototype/1.7.0.0/prototype.js" type="text/javascript"></script>
    <script type="text/javascript">
      function subtract(ary1, ary2){
        ary2.each(function(item){
          ary1=ary1.without(item);
        });
        return ary1
      }
      function multiple(ary1, ary2){
        var ary = new Array();
        ary1.each(function(item1){
          ary2.each(function(item2){
            var ary_irr = irr.get(item1);
            if(!ary_irr || ary_irr.indexOf(item2)<0){
              ary.push([item1, item2]);
            }
          });
        });
        return ary;
      }
      
      function genKey(key){
        return "<a href='#' onClick='return addKeyword(\""+key+"\");' onMouseDown='return addKeyword(\""+key+"\");'>"+key+"</a> ";
      }

      var relations = new Array();
      var grp = new Hash();
      grp.set('TYPE',$w('笔记本 上网本 台式机 手机'));
      grp.set('BRAND',$w('惠普 联想 华硕 宏基 戴尔 苹果 摩托罗拉'));
      grp.set('CPU',$w('闪龙 羿龙 速龙 i5 i3 i7 Atom'));
      grp.set('CORE',$w('单核 双核 四核 六核 八核'));
      grp.set('RAM',$w('2GB 4GB 8GB 16GB'));
      grp.set('VIDEO',$w('独显 集成 交火'));
      grp.set('OS',$w('Windows MacOS iOS Android WebOS Phone7'));
      grp.set('LCD',$w('电容屏 电阻屏 电磁屏'));
      grp.set('SYS',$w('CDMA2000 WCDMA TD-SCDMA'));
      grp.set('STYLE',$w('直板 翻盖 滑盖 侧滑'));
      
      var all = new Array();
      grp.each(function(pair){
        all = all.concat(pair[1]);
      });

      var irr = new Hash();
      irr.set('笔记本',$w('摩托罗拉 Android iOS WebOS Phone7').concat(grp.get('LCD')).concat(grp.get('STYLE')).concat(grp.get('SYS')));
      irr.set('上网本',$w('苹果 MacOS 闪龙 羿龙 速龙 i5 i3 i7 四核 六核 八核 8GB 16GB').concat(irr.get('笔记本')).concat(grp.get('VIDEO')))
      irr.set('台式机',$w('Atom').concat(irr.get('笔记本')))
      irr.set('手机',$w('惠普 华硕 宏基 戴尔 六核 八核 Windows MacOS').concat(grp.get('CPU')).concat(grp.get('VIDEO')))
      irr.set('惠普',$w('MacOS').concat(irr.get('笔记本')))
      irr.set('联想',$w('MacOS').concat(irr.get('笔记本')))
      irr.set('华硕',$w('MacOS').concat(irr.get('笔记本')))
      irr.set('宏基',$w('MacOS').concat(irr.get('笔记本')))
      irr.set('戴尔',$w('MacOS').concat(irr.get('笔记本')))
      irr.set('摩托罗拉',$w('iOS WebOS Phone7').concat(irr.get('手机')))
      irr.set('苹果',$w('闪龙 羿龙 速龙 Atom Windows Android WebOS Phone7 电阻屏 电磁屏 TD-SCDMA 翻盖 滑盖 侧滑'))
      irr.set('闪龙',$w('四核 六核 八核 MacOS iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('速龙',$w('单核 六核 八核 MacOS iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('羿龙',$w('单核 八核 MacOS iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('Atom',$w('四核 六核 八核 MacOS iOS Android WebOS Phone7 独显 交火').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('i3',$w('单核 六核 八核 iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('i5',$w('单核 六核 八核 iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      irr.set('i7',$w('单核 六核 iOS Android WebOS Phone7').concat(subtract(all, grp.get('CORE').concat(grp.get('RAM')).concat(grp.get('VIDEO')).concat(grp.get('OS')))))
      grp.get('CORE').each(function(item){
        irr.set(item,subtract(all, grp.get('RAM').concat(grp.get('VIDEO')).concat(grp.get('OS'))))
      })
      grp.get('RAM').each(function(item){
        irr.set(item,subtract(all, grp.get('VIDEO').concat(grp.get('OS'))))
      })
      grp.get('VIDEO').each(function(item){
        irr.set(item,all.without('Windows', 'MacOS'))
      })
      grp.get('OS').each(function(item){
        irr.set(item,all)
      })
      grp.get('LCD').each(function(item){
        irr.set(item,subtract(all, grp.get('SYS').concat(grp.get('STYLE'))))
      })
      grp.get('SYS').each(function(item){
        irr.set(item,subtract(all, grp.get('STYLE')))
      })

      function gen(){
        var keys_grp = $w('TYPE BRAND CPU CORE RAM VIDEO OS LCD SYS STYLE');
        var hash = new Hash();
        for (var i=0,len=keys_grp.length; i<len-1; i++){
          var ary1 = grp.get(keys_grp[i]);
          for (var j=i+1; j<len; j++){
            var ary2 = grp.get(keys_grp[j]);
            var ary = multiple(ary1, ary2);
            relations = relations.concat(ary);
          }
        }
        
        var key, html="", counter=0;
        relations.sort(function(a,b){
          return all.indexOf(a[0])-all.indexOf(b[0]);
        }).each(function(relation){
          if(key!=relation[0]){
            key=relation[0];
            html+=("<br>"+key+" :&nbsp; &nbsp; &nbsp;");
          }
          html+=(" "+genKey(relation[1]));
        });
        log(html);
      }
      
      function irrelevant(key1, key2){
        var flag=false;
        grp.each(function(pair){
          if(pair[1].indexOf(key1)>=0 && pair[1].indexOf(key2)>=0){
            flag=true;
            return;
          }
        });
        
        if(flag) return true;
        
        var index1 = all.indexOf(key1);
        var index2 = all.indexOf(key2);
        if(index1<index2){
          return irr.get(key1) && irr.get(key1).indexOf(key2)>=0;
        }else{
          return irr.get(key2) && irr.get(key2).indexOf(key1)>=0;
        }
      }
    
      function getRelatedKeywords(keywords){
        var hash = new Hash();
        relations.each(function(relation){
          var x=0;
          if (keywords.indexOf(relation[x++])>=0 || keywords.indexOf(relation[x++])>=0){
            x=x%2;
            if(keywords.indexOf(relation[x])<0){
              var rank = hash.get(relation[x]);
              hash.set(relation[x], rank?rank+1:1);
            }
          }
        });
        return hash.keys().sort(function(a,b){
          return hash.get(b)-hash.get(a);
        });
      }
      
      function updateKeywords(){
        var ary = $("keyword").value.split(' ').uniq();
        keywords = getRelatedKeywords(ary);
        if(!keywords || keywords.length==0) keywords=grp.get('TYPE')
        
        var html = "", counter=0;
        keywords.each(function(key){
          var flag = false;
          ary.each(function(k){
            if(irrelevant(k, key)){
              flag=true;
            }
          })
          
          if(!flag) {
            html+= genKey(key);
          }
        });
        print(html);
      }
      
      function addKeyword(keyword){
        if ($("keyword").value.indexOf(keyword)<0){
          $("keyword").value= $("keyword").value.trim()+" "+keyword;
          updateKeywords();
        }
        return false;
      }
      
      function print(html){
        $("keywords").innerHTML = html;
      }
      
      function log(html){
        $("log").innerHTML = (html+"<br>");
      }
      
      function getid(){
        var url = "http://item.taobao.com/item.htm?id=1234567890&";
        var regTaobaoId = new  RegExp('.*[?&]id=(\\d+).*');
        if(url.match(regTaobaoId)){
          return url.replace(regTaobaoId, "$1");
        }
        return "";
      }
    </script>
</head>


<body onload="gen();updateKeywords()">
  <input type="text" id="keyword" onchange="updateKeywords()" onkeyup="updateKeywords()" onkeydown="updateKeywords()" size="40"/>
  <a href="#" onClick="$('keyword').value='';updateKeywords()">clear</a>
  <a href="new_search.html">reload</a>
  <a href="javascript:alert(getid())">getid</a>
  <div id="keywords"></div>
  <div id="log" style="font-size:10pt"></div>
</body>
</html>
