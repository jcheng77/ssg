<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="#">菠萝蜜</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li>
                        <%= link_to_if(current_user.nil?, "我的首页") do
                          link_to "我的首页", dashboard_user_path(current_user)
                        end %></li>
                    <li>
                        <%= link_to_if(current_user.nil?, "去逛逛") do
                          link_to "去逛逛", items_path
                        end %></li>
                    <li>
                        <%= link_to_if(current_user.nil?, "我的圈子") do
                          link_to "我的圈子", friends_user_path(current_user)
                        end %></li>
                </ul>
                <%= form_for(:item, :url => search_items_path, :method => :get, :html => {:class => "navbar-search pull-left"}) do %>
                    <input type="text" name="search_content" id="search" class="search-query span2" value="<%= params[:search_content] %>" placeholder="搜索宝贝" data-provide="typeahead" data-items="10" data-source='<%= Item.tags %>'>
                <% end %>
                <% if current_user %>
                    <ul class="nav pull-right">
                        <li class="divider-vertical"></li>
                        <li class="dropdown" id="menu">
                            <a class="dropdown-toggle" id='preference-button' data-toggle="dropdown" href="#"><%= current_user.nick_name %> </a>
                            <ul id='preference-panel' class="dropdown-menu" aria-labelledby="preference-button">
                                <li><%= empty_link_if(current_user.nil?, "偏好设置") { edit_preferences_user_path(current_user) } %></li>
                                <li><%= empty_link_if(current_user.nil?, "帐号信息") { account_user_path(current_user) } %></li>
                                <li><%= empty_link_if(current_user.nil?, "通知中心") { notifications_path(current_user) } %></li>
                                <li><%= empty_link_if(current_user.nil?, "退出") { logout_path(current_user) } %></li>
                            </ul>
                        </li>
                    </ul>
                    <!--<%= link_to "我要分享", share_items_path, class: "btn btn-warning pull-right" %>-->
                    <a id='share-btn' role="button" class="btn btn-warning pull-right" rel="#share-panel">我要分享</a>

                <% end %>
                <!--<a href="#" class="pull-right notification-badge" style="display:none" id="notification-badge">0</a>-->
                <ul class='pull-right notification-cont'>
                    <li class="dropdown" id="notifications">
                        <a class="dropdown-toggle notification-badge" id="notification-badge" style="display:none" data-toggle="dropdown" href="#">0</a>
                        <ul class="dropdown-menu notification-panel" id="notification-panel" aria-labelledby="notification-badge" role="menu"></ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<% if current_user %>

    <div class="simple_overlay" id="share-panel">
        <div class="overlay-link">
            <%= form_tag collecter_path, :remote => true, :style => "margin: 0px;", :id => "collect_item_form" do %>
                <%= text_field_tag :url, nil, :style => 'width: 600px', :class => 'input-medium search-query shareUrl', placeholder: "请输入需要分享的商品链接..." %>
                <button class="btn btn-primary" id="parseUrl-btn" type="submit">下一步</button>
            <% end %>
        </div>
        
        <div id="overlay-detail">
            <form  class="simple_form form-horizontal tag-form share-detail">
        <div  id="overlay-detail-mock" class="bookmarklet_container row">
        <div class="span3">
            <div class="share-details-price"></div>
            <div class="share-details-title"></div>

            <div class="images_picker" style='height:396px'></div>
        </div>

        <div class="span6">
            <div class="control-group string required">  
                <label class="string required control-label" for="item_category"><abbr title="required">*</abbr> 分类</label>
                <div class="controls">
                    <select name="item[category]"><option value="数码">数码</option></select>
                </div>
            </div>            
            <div class="control-group string optional">
                <label class="string optional control-label" for="item_rating_comp">推荐指数</label>
                <div class="controls">
                    <div stars="" scorename="share[product_rating]" style="width: 100px; cursor: pointer; ">
                        <img  src="/assets/smallStars/star-off.png" alt="1" title="" class="rating_comp">&nbsp;<img src="/assets/smallStars/star-off.png" alt="2" title="" class="rating_comp">&nbsp;<img  src="/assets/smallStars/star-off.png" alt="3" title="" class="rating_comp">&nbsp;<img src="/assets/smallStars/star-off.png" alt="4" title="" class="rating_comp">&nbsp;<img src="/assets/smallStars/star-off.png" alt="5" title="" class="rating_comp">
                    </div>
                </div>
            </div>                
            <div class="control-group string optional">
                <label class="string optional control-label" for="item_tags">标签</label>
                <div class="controls">
                    <ul class="tags">
                        <li><input type="text" style="width: 30px;"></li>
                    </ul>   
                </div>
            </div>
            <div class="control-group string optional">
                <label class="string optional control-label" for="item_comment">推荐评论</label>
                <div class="controls">
                    <textarea class="input-xlarge" include_blank="false" name="share[comment]" rows="5"></textarea>
                </div>
            </div> 
            <div class="controls">
                <input type="checkbox" name="add_to_wish" >&nbsp;&nbsp;加入愿望&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="checkbox" name="add_to_bought">&nbsp;&nbsp;加入已购
            </div>
        </div>
</div>
</form>
        </div>
        <!-- end of static part -->
    </div>

    <script>
        $(document).ready(function () {
            $("#share-btn").overlay({
                                        fixed : false,
                                        mask: {
                                                color: '#ebecff',
                                                loadSpeed: 200,
                                                opacity: 0.9
                                               }
                                    });
            $("#share-btn").overlay().close(function () {
                // $('#share-panel').css('height', 'auto');
                // $('#bookmarklet_container').show();
                // $('#overlay-detail-mock').hide();
            });

            // use UJS ajax call event: https://github.com/rails/jquery-ujs/wiki/ajax
            $('#collect_item_form').on('ajax:before',function () {
                $('#bookmarklet_container').show();
                // $('#overlay-detail').html("<p style='line-height: 50px; text-align: center; font-size: 16px; font-weight: bolder;'>正在分析...</p>");
            }).on('ajax:error', function (xhr, status, error) {
                // $("#overlay-detail").html("");
                alert("出错啦！");
            });
        });
    </script>
<% end %>
